\documentclass[11pt,a4paper,english]{article}
\usepackage[english]{babel} % Using babel for norwegian hyphenation
\usepackage{lmodern} % Changing the font
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{tcolorbox}
\usepackage[parfill]{parskip} % Removes indents
\usepackage{amsmath} % Environment, symbols etc...
\usepackage{amssymb}
\usepackage{float} % Fixing figure locations
\usepackage{multirow} % For nice tables
\usepackage{graphicx} % For pictures etc...
\usepackage{enumitem} % Points/lists
\usepackage{url}
\usepackage{hyperref}
\usepackage{caption}
\usepackage{subcaption}
\DeclareGraphicsExtensions{.png}

\definecolor{red}{RGB}{255,10,10}

% To include code(-snippets) with æøå
\usepackage{listings}
\lstset{
language=c++,
showspaces=false,
showstringspaces=false,
frame=l,
}

\tolerance = 5000 % Bedre tekst
\hbadness = \tolerance
\pretolerance = 2000

\numberwithin{equation}{section}

\newcommand{\conj}[1]{#1^*}
\newcommand{\ve}[1]{\mathbf{#1}} % Vektorer i bold
\let\oldhat\hat
\renewcommand{\hat}[1]{\mathbf{\oldhat{#1}}}
\newcommand{\trans}[1]{#1^\top}
\newcommand{\herm}[1]{#1^\dagger}
\newcommand{\Real}{\mathbb{R}}
\newcommand{\bigO}[1]{\mathcal{O}\left( #1 \right)}

\newcommand{\spac}{\hspace{5mm}}

\title{UNIK4660 - Assignment 2}
\author{Wilhelm Karlsen and Magnus Elden}
\date{\today}

\begin{document}
\maketitle
In this assignment we are first to visualize two sets of vector fields by their field lines. Secondly, to create a Line Integral Convolution(LIC) implementation and show its functionality on these fields. The vector field are given in the form of two .hdf5 files and are two different hurricane simulations, Isabel and Metsim.
\\
We are also to implement and compare different integration methods, specifically Forward Euler and Fourth Order Runge-Kutta, and use differently sized convolution kernels. The results are shown and discussed at the end of this report.

\section{Field Line Visualization}
Visualization of field lines are intended to represent the vector field as numerous lines conforming to its orientation. This method is very dependent on the points, called seed points, from which the streamlines are calculated. Passing over the vector field and using everything for streamline would simply give a chaotic and unusable image. Seed point strategies are therefore employed to find the best start point for each streamline. 
\\
We have chosen to test evenly spaced seed points, as well as randomly generated points with no restrictions.

\section{Line Integral Convolution}
LIC is a visualization technique used to show the motion and flow in fluids. Using a simple gray-scale noise image it generates a texture by taking every pixel in the image and running it through a convolution kernel. The intended effect is lines that follow the vector field, and gives good, intuitive understanding of the flow direction. The lines are kept distinct by the varying gray scales, though they can also be given different colors to help show additional information, such as the vector magnitude.
\\
Given a field line $\sigma$, the operation can be described by
\begin{align*}
	I(x_0) = \int_{S_0+L}^{S_0-L}k(s - s_0)T(\sigma(s))ds
\end{align*}
Where $I(x_0)$ is the intensity of a pixel at $x_0 = \sigma(s_0)$. $k$ is the convolution kernel with length $2L$, and $s$ is the arc-length.

\subsection{Fast LIC}
Our LIC implementation uses the the "Fast LIC" algorithm presented in the lecture. With a constant box function as the filter kernel, the integration of the streamline origin is: \\
\begin{align*}
	I(x_0) = k \int^{n}_{i = -n}T(x_i)
\end{align*}
This allows the convolution of the streamline in both directions as we pass over the input image by the simple function below:
\begin{align*}
	I(x_{m+1}) &= I(x_m) + k[T(x_{m+1+n}) - T(x_{m-n})], m = 0, 1,..., M	\\
	I(x_{m-1}) &= I(x_m) + k[T(x_{m-1-n}) - T(x_{m+n})], m = 0, 1,..., M
\end{align*}
This should help speed up the execution. However, as we did not implement normal LIC, we do not have anything to compare it to.

\section{Implementation}
For our implementation, both geometric field lines and LIC, we have chosen to use Simple DirectMedia Layer(SDL) library for the graphical representation. The library have allowed us to quickly see the effect of any changes we have done in the code.
\\
During the integration we handle critical points by simply ignoring the point if it is used as the origin. If the field line integration reaches one, it stops there. Interpolation uses it as any other vector in the field.
\\
Should the integration try to pass beyond the boundaries of the vector field, we stop the integration in that direction. In the LIC implementation this has the effect of cutting short the convolution in both directions since we are using the Fast LIC algorithm.

\subsection{Forward Euler integration}
The forward Euler integration scheme is the simplest of the two schemes. 
\begin{align*}
	\psi_{n+1} =& \psi_n + hf(x_n, y_n)
\end{align*}
With $\psi_n$ as the current coordinates for the output image, $h$ as the step size and $f$ as the vector field function.

\subsection{Fourth Order Runge-Kutta integration}
Runge-Kutta is a bit more complicated, and where Euler takes the step in one go, RK divides it into four parts.
\begin{align*}
	k_1 =& f(x_n, y_n)h	\\
	k_2 =& f(x_n + \frac{k_1}{2}, y_n + \frac{k_1}{2})	\\
	k_3 =& f(x_n + \frac{k_2}{2}, y_n + \frac{k_2}{2})	\\
	k_4 =& f(x_n + k_3, y_n + k_3	\\	
	\psi_{n+1} =& \psi_n + \frac{k_1}{6} + \frac{k_2}{3} + \frac{k_3}{3} + \frac{k_4}{6}
\end{align*}

\newpage
\section{Results}

\subsection{Streamlines}
\begin{figure}[ht]
	\centering
	\hspace*{-1.5cm}
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/I10x10E500S}
		\caption{Euler}
		\label{fig:sub1}
	\end{subfigure}%
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/I10x10RK500S}
		\caption{Runge-Kutta}
		\label{fig:sub2}
	\end{subfigure}
	\caption{Isabel: Seedpoints evenly dispersed as a 10x10 grid.}
	\label{fig:test}
\end{figure}

\begin{figure}[ht]
	\centering
	\hspace*{-1.5cm}
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/IRandE500S}
		\caption{Euler}
		\label{fig:sub1}
	\end{subfigure}%
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/IRandRK500S}
		\caption{Runge-Kutta}
		\label{fig:sub2}
	\end{subfigure}
	\caption{Isabel: 100 randomly generated seedpoints}
	\label{fig:test}
\end{figure}

\newpage
\begin{figure}[ht]
	\centering
	\hspace*{-1.5cm}
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/M10x10E500S}
		\caption{Euler}
		\label{fig:sub1}
	\end{subfigure}%
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/M10x10RK500S}
		\caption{Runge-Kutta}
		\label{fig:sub2}
	\end{subfigure}
	\caption{Metsim: Seedpoints evenly dispersed as a 10x10 grid.}
	\label{fig:test}
\end{figure}
\begin{figure}[ht]
	\centering
	\hspace*{-1.5cm}
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/MetRandE200S}
		\caption{Euler}
		\label{fig:sub1}
	\end{subfigure}%
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/MetRandRK200S}
		\caption{Runge-Kutta}
		\label{fig:sub2}
	\end{subfigure}
	\caption{Metsim: 100 randomly generated seedpoints}
	\label{fig:test}
\end{figure}

\newpage
\begin{figure}[ht]
	\centering
	\hspace*{-1.5cm}
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/Isabel-Euler_DL_500_212t}
		\caption{Euler}
		\label{fig:sub1}
	\end{subfigure}%
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/Isabel-RK_DL_500_229t}
		\caption{Runge-Kutta}
		\label{fig:sub2}
	\end{subfigure}
	\caption{Isabel}
	\label{fig:test}
\end{figure}
\begin{figure}[ht]
	\centering
	\hspace*{-1.5cm}
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/Metsim-Euler_DL_500_51t}
		\caption{Euler}
		\label{fig:sub1}
	\end{subfigure}%
	\begin{subfigure}{.6\textwidth}
		\centering
		\includegraphics[width=0.8\linewidth]{Images/Metsim-RK_DL_500_74t}
		\caption{Runge-Kutta}
		\label{fig:sub2}
	\end{subfigure}
	\caption{Metsim}
	\label{fig:test}
\end{figure}

\newpage
\section{Comparisons and Conclusion}

Unfortunatly, we have a flaw in our algorithm which flipps sections of the vector sets causing our results to differ greatly from the examples provided. This is especially noticable in the visualization of the Metsim dataset, where the vectors are almost all diagonal in contrast with the oval example. In Isabel some of the vectors seem mirrored, but the vortex seems to be in the correct position. 

\subsection{Streamlines}
In general the Runge-Kutta method proved itself to create the smoothest streamlines. Forward Euler had a tendency to rotate its direction more rapidly resulting in sharper turns and more ragged looking lines. The randomly selected seed points usually resulted in worse results with more cluttering when used with the Isabel dataset, while due to the specific nature of our Metsim dataset it generally performed better. Since evenly spaced seed points in a field moving along the diagonal caused most points to follow the same path causing major cluttering and drastically lowered the informative value of the visualization. We used a max streamline length of 500 for the Isabel set, while 200 seemed to be appropriate for Metsim. Choosing a smaller or higher length ended up with partial flow loss or increased cluttering, respectively.

\subsection{Line Integral Convolution}
Just like in the streamlines Runge-Kutta creates much smoother curves, but it also creates less distinction between them, slightly lowering the ease of interpreting the results. \\
In the Isabel set, Euler gives some strange detail in the upper and lower right side of the image. This is not shown when using Runke-Kutta, but we suspect this is an artefact from the vector data read errors.
\\
In the Metsim set, the disturbance in the middle is very noticeable when using Euler, compared to the smoother Runge-Kutta.
\\
We did experiment with varying the length of the convolution. However, it gave almost no variation in execution time, barely a second longer for each additional hundred points. This is likely because we implemented the fast LIC algorithm, which places a specific limit to how many times a single image pixel can be affected by the convolution. So the extra time spent on there was regained when skipping image pixels in the main loop.

\subsection{Geometric field lines vs LIC}
The geometric field line visualization gave a good overview, though much detail was lost compared to the LIC. As we did not use any complicated seeding strategies it was almost instantaneous. We still saw the begininng of the spiral in Isabel, but only a slight curve in Metsim. It is likely that with another seeding strategy, we would have gotten better details.
\\
In contrast, the LIC gave a highly detailed result which were easy to interpret. Though there is a use for both, the quality and ease of interpretation of the LIC makes it superior to the geometric method, when calculation time is not an issue.
\end{document}
